# 台股資料抓取工具 - 部署說明

## 🚀 部署架構

- **後端**：Railway（Python Flask API）
- **前端**：GitHub Pages（靜態網頁）

---

## 📦 後端部署到 Railway

### 步驟 1：準備 Railway 帳號

1. 前往 [Railway.app](https://railway.app/)
2. 使用 GitHub 帳號登入

### 步驟 2：部署後端

#### 方法一：透過 GitHub（推薦）

1. 將專案推送到 GitHub
   ```bash
   git init
   git add .
   git commit -m "Initial commit"
   git remote add origin YOUR_GITHUB_REPO_URL
   git push -u origin main
   ```

2. 在 Railway 建立新專案
   - 點擊 "New Project"
   - 選擇 "Deploy from GitHub repo"
   - 選擇你的儲存庫
   - Railway 會自動偵測 Python 專案並部署

#### 方法二：透過 Railway CLI

1. 安裝 Railway CLI
   ```bash
   npm i -g @railway/cli
   ```

2. 登入並部署
   ```bash
   railway login
   railway init
   railway up
   ```

### 步驟 3：設定環境變數（可選）

在 Railway 專案設定中新增：
- `PORT`: 自動設定，無需手動設定
- `DEBUG`: `False`

### 步驟 4：取得 API URL

部署完成後，Railway 會提供一個 URL，例如：
```
https://your-app-name.railway.app
```

記下這個網址，待會要在前端使用。

---

## 🌐 前端部署到 GitHub Pages

### 步驟 1：建立 GitHub 儲存庫

1. 在 GitHub 建立新儲存庫（可以和後端同一個）
2. 將檔案推送到儲存庫

### 步驟 2：啟用 GitHub Pages

1. 進入儲存庫設定（Settings）
2. 找到「Pages」選項
3. 在「Source」選擇「main」分支
4. 點擊「Save」

### 步驟 3：設定 API URL

**部署前必須完成：**

1. 編輯 `config.js` 檔案
2. 將 `API_BASE_URL` 改為你的 Railway API URL
   ```javascript
   const CONFIG = {
       API_BASE_URL: 'https://your-app.railway.app',  // ← 改成你的 Railway URL
       ALLOW_MANUAL_CONFIG: true,
       API_VERSION: '2.0'
   };
   ```
3. 儲存並推送到 GitHub

**推送到 GitHub：**
```bash
git add config.js taiwan-stock-scraper-v2.html
git commit -m "Update API URL for production"
git push
```

GitHub Pages 部署完成後，開啟網頁：
```
https://YOUR_USERNAME.github.io/YOUR_REPO_NAME/taiwan-stock-scraper-v2.html
```

**選項：手動設定功能**
- 如果 `config.js` 中 `ALLOW_MANUAL_CONFIG` 為 `true`，用戶可以在網頁上手動修改 API URL
- 如果設為 `false`，則只能使用 `config.js` 中設定的網址（適合單一後端環境）

---

## 🔧 本地開發

### 後端

1. 安裝依賴
   ```bash
   pip install -r requirements.txt
   ```

2. 啟動伺服器
   ```bash
   python stock_api.py
   ```

### 前端

直接在瀏覽器開啟 `taiwan-stock-scraper-v2.html`

---

## 📊 資料確認

### ✅ 可抓取的資料

#### 1. 每日股價資料（開高低收）
- 日期
- 開盤價
- 最高價
- 最低價
- 收盤價
- 成交股數
- 成交金額
- 成交筆數
- 漲跌價差

#### 2. 三大法人買賣超
- 外資及陸資（買進、賣出、買賣超）
- 投信（買進、賣出、買賣超）
- 自營商（買進、賣出、買賣超）
- 三大法人買賣超合計

---

## ⚙️ 檔案說明

### 後端檔案
- `stock_api.py` - Flask API 主程式
- `requirements.txt` - Python 套件依賴
- `Procfile` - Railway 部署配置
- `runtime.txt` - Python 版本指定
- `.env.example` - 環境變數範例

### 前端檔案
- `taiwan-stock-scraper-v2.html` - 網頁介面
- `config.js` - API 設定檔（部署前需修改）

### 文件檔案
- `使用說明.md` - 使用者使用說明
- `部署說明.md` - 本檔案（部署說明）

---

## 🛠️ 故障排除

### 問題 1：Railway 部署失敗

**可能原因**：
- Python 版本不相容
- 套件依賴問題

**解決方法**：
1. 檢查 Railway 部署日誌
2. 確認 `requirements.txt` 所有套件都能安裝
3. 嘗試更新 `runtime.txt` 中的 Python 版本

### 問題 2：前端無法連接後端

**可能原因**：
- CORS 問題
- API URL 設定錯誤
- Railway 伺服器未啟動

**解決方法**：
1. 確認 Railway 服務正在運行
2. 檢查 API URL 是否正確（包含 https://）
3. 在瀏覽器開發者工具查看錯誤訊息

### 問題 3：GitHub Pages 顯示 404

**可能原因**：
- 檔案路徑錯誤
- GitHub Pages 未正確啟用

**解決方法**：
1. 確認檔案已推送到 GitHub
2. 檢查 GitHub Pages 設定是否正確
3. 使用正確的 URL 格式

---

## 💡 進階配置

### 自訂網域

#### Railway
1. 在 Railway 專案設定中新增自訂網域
2. 依照指示設定 DNS 記錄

#### GitHub Pages
1. 在 GitHub 儲存庫設定中新增自訂網域
2. 設定 CNAME 記錄指向 `YOUR_USERNAME.github.io`

### 安全性優化

1. 在 `stock_api.py` 中限制 CORS 來源：
   ```python
   CORS(app, resources={r"/api/*": {
       "origins": ["https://YOUR_USERNAME.github.io"]
   }})
   ```

2. 新增 API 使用限制（Rate Limiting）

---

## 📧 技術支援

如有問題，請確認：
1. Railway 服務正在運行
2. GitHub Pages 已正確啟用
3. API URL 設定正確
4. 網路連線正常

---

## 🎉 部署完成

現在你的台股資料抓取工具已經部署完成！
- 後端 API 在 Railway 上運行
- 前端網頁可透過 GitHub Pages 存取
- 任何人都可以使用你的工具抓取股票資料並下載 CSV！
