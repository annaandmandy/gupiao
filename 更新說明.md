# 📊 台股資料抓取工具 - 功能更新說明

## 🎉 v2.1 新增功能

### 新增三大類指標

#### 1️⃣ 基本面指標
從台灣證券交易所抓取每日基本面數據：
- **本益比（PE Ratio）**：評估股票價格相對於每股盈餘的比率
- **殖利率（%）**：股息收益率，評估投資報酬率
- **股價淨值比（PB Ratio）**：股價相對於每股淨值的比率
- **股利年度**：股利發放年度資訊
- **財報年季**：財報對應的年度和季度

**API 來源**：`https://www.twse.com.tw/rwd/zh/afterTrading/BWIBBU_d`

#### 2️⃣ 技術指標（自動計算）
系統自動根據價格資料計算技術分析指標：
- **漲跌幅百分比（%）**：相對於前一收盤價的漲跌幅度
- **MA5（5日移動平均線）**：近5個交易日的平均收盤價
- **MA10（10日移動平均線）**：近10個交易日的平均收盤價
- **MA20（20日移動平均線）**：近20個交易日的平均收盤價

**計算方式**：
```python
漲跌幅(%) = (漲跌價差 / (收盤價 - 漲跌價差)) × 100
MA5 = (最近5天收盤價總和) / 5
```

#### 3️⃣ 成交量分析（自動計算）
系統自動分析成交量變化：
- **量變化率（%）**：相對於前一交易日的成交量變化百分比
- **量比**：當日成交量與近5日平均成交量的比值
- **成交量（億股）**：以億股為單位顯示成交量

**計算方式**：
```python
量變化率(%) = ((今日成交量 - 昨日成交量) / 昨日成交量) × 100
量比 = 今日成交量 / 近5日平均成交量
成交量(億股) = 成交股數 / 100,000,000
```

---

## 🎯 使用方式

### 在網頁介面勾選需要的資料類型：

1. ☑️ **每日股價資料**（開盤、收盤、最高、最低、成交量）
2. ☑️ **三大法人買賣超**（外資、投信、自營商）
3. ☑️ **基本面指標**（本益比、殖利率、股價淨值比）⭐ 新增
4. ☑️ **技術指標**（MA5/MA10/MA20 移動平均線、漲跌幅%）⭐ 新增
5. ☑️ **成交量分析**（量變化率、量比、成交量億股）⭐ 新增

### 範例：完整分析台積電（2330）

```
股票代碼：2330
日期區間：2024-01-01 至 2024-01-14（14天）
資料類型：全選（勾選所有5個選項）
```

**下載的 CSV 將包含**：
- 日期、股票代碼
- 開盤價、最高價、最低價、收盤價、漲跌價差、漲跌幅(%)
- 成交股數、成交金額、成交筆數、成交量(億股)
- 量變化率(%)、量比
- MA5、MA10、MA20
- 外資買進/賣出/買賣超
- 投信買進/賣出/買賣超
- 自營商買賣超、三大法人買賣超合計
- 本益比、殖利率(%)、股價淨值比、股利年度、財報年季

---

## 📋 CSV 欄位說明（按照順序排列）

CSV 檔案的欄位已經過精心組織，相同類別的資料會排在一起，方便閱讀和分析：

### 📅 1. 基本資訊（2欄）
| 順序 | 欄位名稱 | 說明 |
|-----|---------|------|
| 1 | 日期 | 交易日期 (YYYY-MM-DD) |
| 2 | 股票代碼 | 股票代號 |

### 💹 2. 價格資料（6欄）
| 順序 | 欄位名稱 | 說明 | 資料來源 |
|-----|---------|------|---------|
| 3 | 開盤價 | 當日開盤價格 | API |
| 4 | 最高價 | 當日最高價格 | API |
| 5 | 最低價 | 當日最低價格 | API |
| 6 | 收盤價 | 當日收盤價格 | API |
| 7 | 漲跌價差 | 相對前日的漲跌金額 | API |
| 8 | 漲跌幅(%) | 漲跌幅百分比 | 計算 ⭐ |

### 📊 3. 成交量基本資料（3欄）
| 順序 | 欄位名稱 | 說明 | 資料來源 |
|-----|---------|------|---------|
| 9 | 成交股數 | 當日成交股數 | API |
| 10 | 成交金額 | 當日成交金額 | API |
| 11 | 成交筆數 | 當日成交筆數 | API |

### 📈 4. 成交量分析（3欄）
| 順序 | 欄位名稱 | 說明 | 資料來源 |
|-----|---------|------|---------|
| 12 | 成交量(億股) | 以億股為單位 | 計算 ⭐ |
| 13 | 量變化率(%) | 相對前日量變化 | 計算 ⭐ |
| 14 | 量比 | 相對5日均量比值 | 計算 ⭐ |

### 📉 5. 技術指標（3欄）
| 順序 | 欄位名稱 | 說明 | 資料來源 |
|-----|---------|------|---------|
| 15 | MA5 | 5日移動平均線 | 計算 ⭐ |
| 16 | MA10 | 10日移動平均線 | 計算 ⭐ |
| 17 | MA20 | 20日移動平均線 | 計算 ⭐ |

### 🏦 6. 三大法人 - 外資（3欄）
| 順序 | 欄位名稱 | 說明 | 資料來源 |
|-----|---------|------|---------|
| 18 | 外資買進 | 外資買進股數 | API |
| 19 | 外資賣出 | 外資賣出股數 | API |
| 20 | 外資買賣超 | 外資買賣超股數 | API |

### 🏢 7. 三大法人 - 投信（3欄）
| 順序 | 欄位名稱 | 說明 | 資料來源 |
|-----|---------|------|---------|
| 21 | 投信買進 | 投信買進股數 | API |
| 22 | 投信賣出 | 投信賣出股數 | API |
| 23 | 投信買賣超 | 投信買賣超股數 | API |

### 🏪 8. 三大法人 - 自營商與合計（2欄）
| 順序 | 欄位名稱 | 說明 | 資料來源 |
|-----|---------|------|---------|
| 24 | 自營商買賣超 | 自營商買賣超股數 | API |
| 25 | 三大法人買賣超合計 | 總買賣超 | API |

### 💼 9. 基本面指標（5欄）
| 順序 | 欄位名稱 | 說明 | 資料來源 |
|-----|---------|------|---------|
| 26 | 本益比 | PE Ratio | API ⭐ |
| 27 | 殖利率(%) | Dividend Yield | API ⭐ |
| 28 | 股價淨值比 | PB Ratio | API ⭐ |
| 29 | 股利年度 | 股利發放年度 | API ⭐ |
| 30 | 財報年季 | 財報對應年季 | API ⭐ |

---

### 📌 欄位組織說明

CSV 欄位已經按照**邏輯分類**進行排序：

1. **日期最左邊**：方便以時間序列查看
2. **價格資料緊接著**：OHLC（開高低收）是最基本的資訊
3. **成交量相關集中**：基本成交量資料 + 衍生分析指標
4. **技術指標獨立一組**：所有計算型技術指標
5. **三大法人按類別分組**：外資、投信、自營商分開，便於比較
6. **基本面指標在最後**：財務相關數據

這樣的排序讓 CSV 檔案更易讀，也方便在 Excel 或其他工具中進行分析！

---

## 🔧 技術實現

### 後端更新 (`stock_api.py`)

新增三個函數：

1. **`fetch_fundamental_data()`**
   - 從證交所 BWIBBU_d API 抓取基本面資料
   - 逐日查詢，整合到主資料集

2. **`calculate_technical_indicators()`**
   - 根據收盤價計算移動平均線
   - 計算漲跌幅百分比
   - 需要足夠的歷史資料才能計算

3. **`calculate_volume_analysis()`**
   - 分析成交量變化
   - 計算量比和換手相關指標

### 前端更新 (`taiwan-stock-scraper-v2.html`)

新增三個勾選框：
- ☑️ 基本面指標（fundamental）
- ☑️ 技術指標（technical）
- ☑️ 成交量分析（volume）

---

## ⚠️ 使用注意事項

### 資料完整性
1. **技術指標**：
   - MA5 需要至少 5 天資料
   - MA10 需要至少 10 天資料
   - MA20 需要至少 20 天資料
   - 前幾天可能沒有完整的移動平均線數據

2. **成交量分析**：
   - 量變化率需要前一天資料
   - 量比需要至少 5 天資料

3. **基本面指標**：
   - 部分股票可能沒有完整基本面資料
   - 假日無資料

### 建議查詢區間
- **僅查詢股價 + 技術指標**：可查詢 90 天
- **包含三大法人資料**：建議 7-14 天（最多 30 天）
- **包含基本面指標**：建議 30 天內

---

## 📈 實際應用範例

### 範例 1：短期技術分析
```
股票代碼：2330
日期：2024-01-01 至 2024-01-14
勾選：股價 + 技術指標 + 成交量分析
```
**用途**：觀察短期價格走勢和量價關係

### 範例 2：法人動向分析
```
股票代碼：2454
日期：2024-01-08 至 2024-01-12（5天）
勾選：股價 + 三大法人 + 成交量分析
```
**用途**：追蹤法人買賣動向

### 範例 3：全方位分析
```
股票代碼：2317
日期：2024-01-01 至 2024-01-14
勾選：全選（所有5個選項）
```
**用途**：完整的基本面 + 技術面 + 籌碼面分析

---

## 🚀 部署更新

如果你已經部署到 Railway，請執行以下步驟更新：

```bash
# 1. 提交更新
git add .
git commit -m "Add fundamental indicators, technical analysis, and volume analysis"

# 2. 推送到 GitHub（Railway 自動部署）
git push origin main
```

Railway 會自動偵測更新並重新部署。

---

## 📞 回饋與建議

如果你有任何問題或建議，歡迎提出 Issue！

祝你使用愉快！📊✨
